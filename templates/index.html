<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>SmartInbox</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <style>
      body { font-family: system-ui, Arial, sans-serif; max-width: 720px; margin: 40px auto; padding: 0 16px; }
      button { padding: 10px 16px; border: 1px solid #ddd; border-radius: 8px; cursor: pointer; }
      .card { border: 1px solid #eee; border-radius: 12px; padding: 16px; margin-top: 16px; }
      .row { display: flex; gap: 12px; align-items: center; }
      code { background: #f6f6f6; padding: 2px 6px; border-radius: 6px; }
    </style>
  </head>
  <body>
    <h1>SmartInbox</h1>

    {% if not authed %}
      <p>Connect your Gmail to classify your latest unread emails.</p>
      <a href="/authorize"><button>Connect Google</button></a>
    {% else %}
      <div class="card">
        <div class="row">
          <button id="run">Classify last 5 unread (last 1 day)</button>
          <small>Change via query: <code>?n=5&window=1d</code></small>
        </div>
        <pre id="out"></pre>
      </div>
      <p><a href="/logout">Logout</a></p>
    {% endif %}

    <script>
      const btn = document.getElementById('run');
      const out = document.getElementById('out');
      if (btn) {
        btn.onclick = async () => {
          out.textContent = 'Running…';
          const res = await fetch('/classify?n=5&window=1d', { method: 'POST' });
          const data = await res.json();
          if (data.error) { out.textContent = data.error; return; }
          out.textContent = data.items.map(i => `From: ${i.from} → ${i.label}`).join('\n');
        };
      }
    </script>
  </body>
</html>
