<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SmartInbox</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        button { padding: 10px 20px; margin-top: 10px; }
        #status { margin-top: 20px; font-weight: bold; }
    </style>
</head>
<body>
    <h1>SmartInbox</h1>

    {% if authed %}
        <p>Welcome! You are authorized with Google.</p>
        <button id="classifyBtn">Classify last 5 unread (last 1 day)</button>
        <p>Change via query: <code>?n=5&window=1d</code></p>
        <div id="status"></div>
        <p><a href="/logout">Logout</a></p>
    {% else %}
        <p>You are not authorized. <a href="/authorize">Login with Google</a></p>
    {% endif %}

    <script>
        const btn = document.getElementById("classifyBtn");
        const status = document.getElementById("status");

        if(btn) {
            btn.addEventListener("click", async () => {
                status.textContent = "Runningâ€¦";
                btn.disabled = true;

                try {
                    const response = await fetch(`/classify?n=5&window=1d`, { method: "POST" });
                    if (response.ok) {
                        const result = await response.json();
                        status.textContent = `Done! Classified ${result.count || 0} emails.`;
                    } else {
                        status.textContent = `Error: ${response.statusText}`;
                    }
                } catch (err) {
                    status.textContent = `Error: ${err.message}`;
                } finally {
                    btn.disabled = false;
                }
            });
        }
    </script>
</body>
</html>